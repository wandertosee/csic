!function(){function e(e,t){console.log("updateView"),_.itemsId.innerHTML="";var n="";e.forEach(function(e){n+=t(e)}),_.itemsId.innerHTML=n}function t(e){var t=[I._dbName,I._modelRef,I.keyPath,e[I.keyPath]].join("/");return'<a class="list-group-item" id="'+e[I.keyPath]+'" href="#/'+t+'">'+e.text+'<button type="button" class="close" data-dismiss="alert">x</button></a>'}function n(e){var t="";e.indexes.forEach(function(n){t+=r(e,n)}),_.searchSelector.innerHTML=t}function r(e,t){var n=[e._dbName,e._modelRef,e.keyPath,t].join("/");return'<li><a class="list-group-item" id="'+t[e.keyPath]+'" href="'+n+'">'+t+"</a></li>"}function o(n){if(n.preventDefault(),n.srcElement.id)if(n.srcElement.id===_.searchFormId){var r=["",I._dbName,I._modelRef,_.searchAttr.value,_.searchValue.value].join("/");s(r)}else h(_.input.value,function(){v(e,t),_.input.value=""})}function a(n){if(n.target.hasAttribute("data-dismiss")){var r=confirm("delete this record?");r&&y(n.target.parentNode.getAttribute("id"),function(){v(e,t)})}}function i(e){e.preventDefault();var t=e.target.innerHTML;_.searchDisplay.innerHTML=t,_.searchAttr.value=t}function c(e){return e.split(",")}function d(){return window.location.hash}function s(e){window.location.hash=e}function u(){p=window.location.hash.split("/"),v(e,t)}function l(e){var t=indexedDB.open(I._dbName,I.version);t.onupgradeneeded=function(e){g=e.target.result,e.target.transaction.onerror=m;var t=g.createObjectStore(I._modelRef,{keyPath:I.keyPath});f(t,I.indexes)},t.onsuccess=function(t){g=t.target.result,e()},t.onerror=m}function f(e,t){for(var n=I.indexes.length-1;n>=0;n--)e.createIndex(t[n],t[n],{unique:!1})}function m(e){console.error("An IndexedDB Error has occurred",e)}function h(e,t){var n=c(e),r=g.transaction(I._modelRef,I._modify),o=r.objectStore(I._modelRef),a=n[1]||Date.now().toString(),i;n[1]&&(i=o.get(a));var d={};d.text=n[0],d[I.keyPath]=a,i=o.put(d),r.oncomplete=function(e){t()},i.onerror=m}function v(n,r){var o=g.transaction(I._modelRef,I._read),a=o.objectStore(I._modelRef),i,c;3===p.length||""===p[3]||""===p[4]?(i=IDBKeyRange.lowerBound(0),c=a.openCursor(i)):""!==p[3]&&(i=a.index(p[3]),c=i.openCursor(IDBKeyRange.only(p[4])));var d=[];c&&(c.onsuccess=function(){var o=c.result;o?(d.push(o.value),o["continue"]()):n?n(d,r):e(d,t)})}function y(e,t){var n=g.transaction(I._modelRef,I._modify),r=n.objectStore(I._modelRef),o=r["delete"](e);n.oncomplete=function(e){t()},o.onerror=m}var g,p=window.location.hash.split("/"),_={itemsId:document.getElementById("listItems"),input:document.getElementById("new"),searchSelector:document.getElementById("searchSelector"),searchFormId:"searchForm",search:document.getElementById("searchForm"),searchAttr:document.getElementById("searchAttr"),searchValue:document.getElementById("searchValue"),searchDisplay:document.getElementById("searchDisplay")},I={_dbName:p[1],_modelRef:p[2],_modify:"readwrite",_read:"readonly",keyPath:"id",version:2.1,indexes:["id","text"]};l(function(){document.body.addEventListener("submit",o),window.addEventListener("hashchange",u,!1),_.itemsId.addEventListener("click",a),_.searchSelector.addEventListener("click",i),n(I),v(e,t)})}();