!function(){function e(e,t){console.log("updateView"),I.itemsId.innerHTML="";var n="";e.forEach(function(e){n+=t(e)}),I.itemsId.innerHTML=n}function t(e){var t=[b._dbName,b._modelRef,b.keyPath,e[b.keyPath]].join("/");return'<a class="list-group-item" id="'+e[b.keyPath]+'" href="#/'+t+'">'+e.text+'<button type="button" class="close" data-dismiss="alert">x</button></a>'}function n(e){var t="";e.indexes.forEach(function(n){t+=o(e,n)}),I.searchSelector.innerHTML=t}function o(e,t){var n=[e._dbName,e._modelRef,e.keyPath,t].join("/");return'<li><a class="list-group-item" id="'+t[e.keyPath]+'" href="'+n+'">'+t+"</a></li>"}function r(n){if(n.preventDefault(),n.srcElement.id)if(n.srcElement.id===I.searchFormId){var o=["",b._dbName,b._modelRef,I.searchAttr.value,I.searchValue.value].join("/");d(o)}else h(I.input.value,function(){v(e,t),I.input.value=""})}function a(n){if(n.target.hasAttribute("data-dismiss")){var o=confirm("delete this record?");o&&y(n.target.parentNode.getAttribute("id"),function(){v(e,t)})}}function i(e){e.preventDefault();var t=e.target.innerHTML;I.searchDisplay.innerHTML=t,I.searchAttr.value=t}function c(e){return e.split(",")}function s(){return window.location.hash}function d(e){window.location.hash=e}function u(){_=window.location.hash.split("/"),v(e,t)}function l(e){var t=indexedDB.open(b._dbName,b.version);t.onupgradeneeded=function(e){p=e.target.result,e.target.transaction.onerror=m;var t=p.createObjectStore(b._modelRef,{keyPath:b.keyPath});f(t,b.indexes)},t.onsuccess=function(t){p=t.target.result,e()},t.onerror=m}function f(e,t){for(var n=b.indexes.length-1;n>=0;n--)e.createIndex(t[n],t[n],{unique:!1})}function m(e){console.error("An IndexedDB Error has occurred",e)}function h(e,t){var n=c(e),o=p.transaction(b._modelRef,b._modify),r=o.objectStore(b._modelRef),a=n[1]||Date.now().toString(),i;n[1]&&(i=r.get(a));var s={};s.text=n[0],s[b.keyPath]=a,i=r.put(s),o.oncomplete=function(e){t()},i.onerror=m}function v(n,o){var r=p.transaction(b._modelRef,b._read),a=r.objectStore(b._modelRef),i,c;3===_.length||""===_[3]||""===_[4]?(i=IDBKeyRange.lowerBound(0),c=a.openCursor(i)):""!==_[3]&&(i=a.index(_[3]),c=i.openCursor(IDBKeyRange.only(_[4])));var s=[];c&&(c.onsuccess=function(){var r=c.result;r?(s.push(r.value),r["continue"]()):(console.log(s),s.length<1&&_[3]&&g(n,o),n?n(s,o):e(s,t))})}function g(n,o){var r=[],a=p.transaction(b._modelRef,b._read),i=a.objectStore(b._modelRef),c,s=i.openCursor();s.onsuccess=function(a){var i=a.target.result;i&&_[4]&&(-1!==i.value[_[3]].indexOf(_[4])&&r.push(i.value),i["continue"]()),n?n(r,o):e(r,t)}}function y(e,t){var n=p.transaction(b._modelRef,b._modify),o=n.objectStore(b._modelRef),r=o["delete"](e);n.oncomplete=function(e){t()},r.onerror=m}var p,_=window.location.hash.split("/"),I={itemsId:document.getElementById("listItems"),input:document.getElementById("new"),searchSelector:document.getElementById("searchSelector"),searchFormId:"searchForm",search:document.getElementById("searchForm"),searchAttr:document.getElementById("searchAttr"),searchValue:document.getElementById("searchValue"),searchDisplay:document.getElementById("searchDisplay")},b={_dbName:_[1],_modelRef:_[2],_modify:"readwrite",_read:"readonly",keyPath:"id",version:2.1,indexes:["id","text"]};l(function(){document.body.addEventListener("submit",r),window.addEventListener("hashchange",u,!1),I.itemsId.addEventListener("click",a),I.searchSelector.addEventListener("click",i),n(b),v(e,t)})}();